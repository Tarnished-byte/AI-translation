<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LipiAnuvaad - AI Document Translation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        #output-area.placeholder::before {
            content: "Your translated English text will appear here...";
            color: #9ca3af;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #video-feed {
            transform: scaleX(-1); /* Mirror view */
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-blue-600">LipiAnuvaad</h1>
            <div class="hidden md:flex space-x-6 items-center">
                <a href="#solution" class="text-slate-600 hover:text-blue-600 transition">Translator</a>
            </div>
             <button id="mobile-menu-button" class="md:hidden text-slate-600 focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </nav>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden px-6 pt-2 pb-4">
             <a href="#solution" class="block py-2 text-slate-600 hover:text-blue-600">Translator</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-12 md:py-20">
        <section class="text-center">
            <h2 class="text-4xl md:text-5xl font-extrabold text-slate-900 mb-4">Translate Nepali & Sinhalese Documents to English</h2>
            <p class="text-lg text-slate-600 max-w-3xl mx-auto mb-8">Use text, files, or your device's camera to instantly translate printed text into English. Powered by AI.</p>
        </section>
        
        <!-- Translation Tool Section -->
        <section id="solution" class="mt-12">
            <div class="glass-card rounded-2xl shadow-lg p-6 md:p-10 border border-slate-200">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                    <!-- Input Area -->
                    <div>
                        <h3 class="text-2xl font-bold mb-4">Start Translating</h3>
                        <div class="bg-white p-4 rounded-lg shadow-inner">
                            <div class="flex border-b border-slate-200 mb-4">
                                <button id="text-tab" class="px-4 py-2 font-semibold text-blue-600 border-b-2 border-blue-600 w-full text-center">Text</button>
                                <button id="image-tab" class="px-4 py-2 font-semibold text-slate-500 w-full text-center">File</button>
                                <button id="camera-tab" class="px-4 py-2 font-semibold text-slate-500 w-full text-center">Camera</button>
                            </div>

                            <!-- Text Input -->
                            <div id="text-input-area">
                                <textarea id="text-input" class="w-full h-48 p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="Paste Nepali or Sinhalese text here..."></textarea>
                            </div>

                            <!-- File Input -->
                            <div id="image-input-area" class="hidden">
                                <label for="image-upload" class="cursor-pointer">
                                    <div class="border-2 border-dashed border-slate-300 rounded-md p-8 text-center hover:border-blue-500 transition">
                                        <svg class="w-12 h-12 mx-auto text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-4-4V6a4 4 0 014-4h10a4 4 0 014 4v6a4 4 0 01-4 4H7z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 16v-4a4 4 0 00-4-4H8a4 4 0 00-4 4v4m16 0l-3-3m-10 0l3-3"></path></svg>
                                        <p class="mt-2 text-slate-600">Click to upload an Image or PDF</p>
                                        <p class="text-sm text-slate-500">PNG, JPG, or PDF file</p>
                                        <input type="file" id="image-upload" class="hidden" accept="image/png, image/jpeg, application/pdf">
                                    </div>
                                </label>
                                <div id="file-preview-container" class="mt-4 hidden">
                                    <p class="text-sm font-medium mb-2">Selected File:</p>
                                    <img id="image-preview" src="#" alt="Image Preview" class="max-h-40 rounded-md shadow-md mx-auto hidden"/>
                                    <div id="pdf-preview" class="text-center hidden">
                                        <svg class="w-12 h-12 mx-auto text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                                        <p class="mt-2 text-slate-600">PDF File Selected</p>
                                    </div>
                                    <p id="file-name" class="text-center text-sm text-slate-500 mt-2"></p>
                                </div>
                            </div>

                            <!-- Camera Input -->
                            <div id="camera-input-area" class="hidden">
                                <div class="bg-black rounded-md overflow-hidden relative">
                                    <video id="video-feed" class="w-full h-auto" autoplay playsinline></video>
                                    <canvas id="canvas" class="hidden"></canvas>
                                </div>
                                <p id="camera-error" class="text-red-500 text-sm mt-2 text-center hidden">Could not access camera. Please grant permission and try again.</p>
                                <button id="capture-btn" class="mt-4 w-full bg-indigo-600 text-white font-bold py-2 px-4 rounded-md hover:bg-indigo-700 transition">Capture Photo</button>
                                <div id="capture-preview-container" class="mt-4 hidden">
                                     <p class="text-sm font-medium mb-2">Captured Image:</p>
                                     <img id="capture-preview" src="#" alt="Capture Preview" class="max-h-40 rounded-md shadow-md mx-auto"/>
                                </div>
                            </div>
                            
                            <button id="translate-btn" class="mt-4 w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-md hover:bg-blue-700 transition shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Translate</button>
                        </div>
                    </div>

                    <!-- Output Area -->
                    <div>
                        <h3 class="text-2xl font-bold mb-4">Translated Output</h3>
                        <div class="bg-white p-4 rounded-lg shadow-inner h-full min-h-[300px] flex flex-col">
                            <div id="output-container" class="relative w-full flex-grow">
                                <div id="loader" class="hidden absolute inset-0 bg-white bg-opacity-75 flex justify-center items-center">
                                    <div class="loader"></div>
                                </div>
                                <div id="output-area" class="w-full h-full p-3 border border-slate-300 rounded-md bg-slate-50 overflow-y-auto placeholder"></div>
                            </div>
                            <button id="copy-btn" class="mt-4 w-full bg-slate-600 text-white font-bold py-3 px-4 rounded-md hover:bg-slate-700 transition shadow-md disabled:bg-slate-400 disabled:cursor-not-allowed" disabled>Copy Text</button>
                            <div id="copy-feedback" class="text-center text-sm text-green-600 mt-2 h-4"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-slate-800 text-white mt-20">
        <div class="container mx-auto px-6 py-8 text-center">
            <p class="font-bold text-lg">BhashaBridge</p>
            <p class="text-slate-400 mt-2">&copy; 2024 LipiAnuvaad. A conceptual project for bridging languages.</p>
        </div>
    </footer>

    <script>
        // --- DOM Elements ---
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const textTab = document.getElementById('text-tab');
        const imageTab = document.getElementById('image-tab');
        const cameraTab = document.getElementById('camera-tab');
        const textInputArea = document.getElementById('text-input-area');
        const imageInputArea = document.getElementById('image-input-area');
        const cameraInputArea = document.getElementById('camera-input-area');
        const imageUpload = document.getElementById('image-upload');
        const imagePreview = document.getElementById('image-preview');
        const filePreviewContainer = document.getElementById('file-preview-container');
        const fileName = document.getElementById('file-name');
        const pdfPreview = document.getElementById('pdf-preview');
        const videoFeed = document.getElementById('video-feed');
        const canvas = document.getElementById('canvas');
        const captureBtn = document.getElementById('capture-btn');
        const capturePreview = document.getElementById('capture-preview');
        const capturePreviewContainer = document.getElementById('capture-preview-container');
        const cameraError = document.getElementById('camera-error');
        const translateBtn = document.getElementById('translate-btn');
        const outputArea = document.getElementById('output-area');
        const loader = document.getElementById('loader');
        const textInput = document.getElementById('text-input');
        const copyBtn = document.getElementById('copy-btn');
        const copyFeedback = document.getElementById('copy-feedback');

        // --- State Management ---
        let currentStream;
        let capturedImageData = null;

        // --- Mobile menu ---
        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // --- Tab Management ---
        const tabs = [textTab, imageTab, cameraTab];
        const tabPanels = [textInputArea, imageInputArea, cameraInputArea];

        tabs.forEach((tab, index) => {
            tab.addEventListener('click', () => {
                // Deactivate all tabs and panels
                tabs.forEach(t => {
                    t.classList.remove('text-blue-600', 'border-blue-600');
                    t.classList.add('text-slate-500');
                });
                tabPanels.forEach(p => p.classList.add('hidden'));

                // Activate clicked tab and panel
                tab.classList.add('text-blue-600', 'border-blue-600');
                tab.classList.remove('text-slate-500');
                tabPanels[index].classList.remove('hidden');

                // Handle camera stream
                if (tab === cameraTab) {
                    startCamera();
                } else {
                    stopCamera();
                }
            });
        });

        // --- Camera Logic ---
        async function startCamera() {
            if (currentStream) return;
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                videoFeed.srcObject = stream;
                currentStream = stream;
                cameraError.classList.add('hidden');
            } catch (err) {
                console.error("Camera access denied:", err);
                cameraError.classList.remove('hidden');
            }
        }

        function stopCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                currentStream = null;
            }
        }
        
        captureBtn.addEventListener('click', () => {
            canvas.width = videoFeed.videoWidth;
            canvas.height = videoFeed.videoHeight;
            const context = canvas.getContext('2d');
            // Flip the context horizontally to un-mirror the captured image
            context.translate(canvas.width, 0);
            context.scale(-1, 1);
            context.drawImage(videoFeed, 0, 0, canvas.width, canvas.height);
            
            capturedImageData = canvas.toDataURL('image/jpeg');
            capturePreview.src = capturedImageData;
            capturePreviewContainer.classList.remove('hidden');
        });

        // --- File Input Logic ---
        imageUpload.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                filePreviewContainer.classList.remove('hidden');
                fileName.textContent = file.name;

                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        imagePreview.src = e.target.result;
                        imagePreview.classList.remove('hidden');
                        pdfPreview.classList.add('hidden');
                    }
                    reader.readAsDataURL(file);
                } else if (file.type === 'application/pdf') {
                    imagePreview.classList.add('hidden');
                    pdfPreview.classList.remove('hidden');
                }
            }
        });

        // --- API & Translation Logic ---
        // IMPORTANT: To make this site work publicly, you need your own API key.
        // 1. Go to https://aistudio.google.com/app/apikey to create a free API key.
        // 2. Paste your key below, replacing "YOUR_API_KEY_HERE".
        // WARNING: Do not share this key publicly or commit it to a public repository.
        const API_KEY = "YOUR_API_KEY_HERE"; // Keep this empty
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
        
        async function getApiResponse(prompt, base64Data = null, mimeType = null) {
            let parts = [{ text: prompt }];
            if (base64Data && mimeType) {
                parts.push({ inlineData: { mimeType: mimeType, data: base64Data } });
            }

            const payload = { contents: [{ role: "user", parts: parts }] };
            let response, delay = 1000;
            for (let i = 0; i < 5; i++) {
                try {
                    response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (response.ok) {
                        const result = await response.json();
                        const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                        return text || "Translation could not be generated. The model's response was empty. This may be due to safety filters.";
                    } else if (response.status === 429 || response.status >= 500) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2;
                    } else {
                        const errorResult = await response.json();
                        return `Error: ${errorResult.error?.message || response.statusText}`;
                    }
                } catch (error) {
                    if (i === 4) return "An error occurred while connecting to the translation service.";
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
            return "The translation service is currently unavailable. Please try again later.";
        }

        translateBtn.addEventListener('click', async () => {
            outputArea.classList.add('placeholder');
            outputArea.innerText = '';
            loader.classList.remove('hidden');
            copyBtn.disabled = true;

            let outputText = "Please provide input to translate.";
            const prompt = "You are LipiAnuvaad, an expert translator. Detect if the language in the text or image is Nepali or Sinhalese and translate it accurately to English. Preserve the core meaning and context. The input is: ";

            if (textTab.classList.contains('border-blue-600')) {
                const currentInput = textInput.value.trim();
                if (currentInput) {
                    outputText = await getApiResponse(prompt + currentInput);
                }
            } else if (imageTab.classList.contains('border-blue-600')) {
                const imageFile = imageUpload.files[0];
                if (imageFile) {
                    if (imageFile.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onloadend = async () => {
                            const base64String = reader.result.split(',')[1];
                            const result = await getApiResponse(prompt, base64String, imageFile.type);
                            displayResult(result);
                        };
                        reader.readAsDataURL(imageFile);
                        return;
                    } else if (imageFile.type === 'application/pdf') {
                        outputText = "PDF processing is a premium feature. This web demo showcases text, image, and camera translation.";
                    }
                }
            } else if (cameraTab.classList.contains('border-blue-600')) {
                if (capturedImageData) {
                    const base64String = capturedImageData.split(',')[1];
                    outputText = await getApiResponse(prompt, base64String, 'image/jpeg');
                } else {
                     outputText = "Please capture a photo first.";
                }
            }
            
            displayResult(outputText);
        });

        function displayResult(text) {
             loader.classList.add('hidden');
             outputArea.classList.remove('placeholder');
             outputArea.innerText = text;
             if (text && !text.startsWith("Error:") && !text.startsWith("Please")) {
                copyBtn.disabled = false;
             }
        }

        // --- Copy to clipboard ---
        copyBtn.addEventListener('click', () => {
            const textToCopy = outputArea.innerText;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = textToCopy;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            try {
                document.execCommand('copy');
                copyFeedback.textContent = 'Copied to clipboard!';
            } catch (err) {
                copyFeedback.textContent = 'Failed to copy.';
            }
            document.body.removeChild(tempTextArea);
            
            setTimeout(() => { copyFeedback.textContent = ''; }, 2000);
        });
    </script>
</body>
</html>


